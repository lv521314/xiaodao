<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电竞陪玩抢单系统 | 企业版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --primary-light: #6366f1;
            --secondary: #7c3aed;
            --success: #10b981;
            --info: #0ea5e9;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e1b4b;
            --darker: #0f172a;
            --light: #f8fafc;
            --gray: #64748b;
            --light-gray: #e2e8f0;
            --white: #ffffff;
            --sidebar-bg: #ffffff;
            --header-bg: #ffffff;
            --card-bg: #ffffff;
            
            --sidebar-width: 280px;
            --header-height: 70px;
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --box-shadow: 0 4px 25px rgba(0, 0, 0, 0.05);
            --box-shadow-lg: 0 10px 35px rgba(0, 0, 0, 0.1);
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #f1f5f9;
            color: #1e293b;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* 侧边栏样式 */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            position: fixed;
            height: 100vh;
            padding: 20px 0;
            transition: var(--transition-slow);
            z-index: 1000;
            box-shadow: var(--box-shadow);
            border-right: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .sidebar-header {
            padding: 0 25px 25px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--dark);
            text-decoration: none;
        }
        
        .sidebar-brand i {
            color: var(--primary);
            font-size: 1.6rem;
        }
        
        .sidebar-menu {
            padding: 25px 0;
        }
        
        .menu-title {
            padding: 10px 25px;
            font-size: 0.8rem;
            text-transform: uppercase;
            color: var(--gray);
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-top: 15px;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 25px;
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
            margin: 5px 0;
            font-weight: 500;
            position: relative;
        }
        
        .menu-item:hover, .menu-item.active {
            background: rgba(79, 70, 229, 0.05);
            color: var(--primary);
            border-left-color: var(--primary);
        }
        
        .menu-item i {
            margin-right: 12px;
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
            color: var(--gray);
        }
        
        .menu-item:hover i, .menu-item.active i {
            color: var(--primary);
        }
        
        .menu-badge {
            position: absolute;
            right: 25px;
            background: var(--primary);
            color: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        /* 主内容区域 */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding-top: var(--header-height);
            transition: var(--transition-slow);
        }
        
        /* 顶部导航 */
        .header {
            height: var(--header-height);
            background: var(--header-bg);
            box-shadow: var(--box-shadow);
            position: fixed;
            top: 0;
            right: 0;
            left: var(--sidebar-width);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 999;
            transition: var(--transition-slow);
        }
        
        .header-left {
            display: flex;
            align-items: center;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: var(--border-radius-sm);
            transition: var(--transition);
        }
        
        .user-profile:hover {
            background: var(--light-gray);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .user-role {
            font-size: 0.75rem;
            color: var(--gray);
        }
        
        /* 主内容容器 */
        .content-wrapper {
            padding: 30px;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .page-title i {
            color: var(--primary);
            font-size: 1.6rem;
        }
        
        .page-actions {
            display: flex;
            gap: 15px;
        }
        
        /* 卡片样式 */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            transition: var(--transition);
            border: none;
            overflow: hidden;
        }
        
        .card:hover {
            box-shadow: var(--box-shadow-lg);
            transform: translateY(-5px);
        }
        
        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .card-body {
            padding: 25px;
        }
        
        /* 统计卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-lg);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }
        
        .stat-label {
            font-size: 0.95rem;
            color: var(--gray);
            font-weight: 500;
        }
        
        .stat-icon {
            position: absolute;
            right: 25px;
            top: 25px;
            font-size: 1.8rem;
            opacity: 0.1;
            color: var(--primary);
        }
        
        .stat-trend {
            display: flex;
            align-items: center;
            margin-top: 10px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .trend-up {
            color: var(--success);
        }
        
        .trend-down {
            color: var(--danger);
        }
        
        /* 图表容器 */
        .chart-container {
            position: relative;
            height: 320px;
            margin-bottom: 30px;
        }
        
        /* 表格样式 */
        .table-responsive {
            overflow-x: auto;
            border-radius: var(--border-radius);
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
        }
        
        .table th {
            background: #f8fafc;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        
        .table td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            vertical-align: middle;
            font-size: 0.95rem;
        }
        
        .table tr:last-child td {
            border-bottom: none;
        }
        
        .table tr:hover {
            background: rgba(79, 70, 229, 0.03);
        }
        
        /* 按钮样式 */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            border-radius: var(--border-radius-sm);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            gap: 10px;
            font-size: 0.95rem;
            line-height: 1;
            white-space: nowrap;
        }
        
        .btn i {
            font-size: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: var(--white);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, var(--primary-dark), var(--secondary));
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(to right, var(--success), #0d9488);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-success:hover {
            background: linear-gradient(to right, #0d9488, #0f766e);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(to right, var(--danger), #dc2626);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .btn-danger:hover {
            background: linear-gradient(to right, #dc2626, #b91c1c);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
            transform: translateY(-2px);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: rgba(79, 70, 229, 0.05);
            color: var(--primary-dark);
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }
        
        .btn-block {
            display: flex;
            width: 100%;
        }
        
        /* 表单控件 */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius-sm);
            font-size: 0.95rem;
            transition: var(--transition);
            background: var(--white);
            color: var(--dark);
        }
        
        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
            outline: none;
        }
        
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px 12px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        /* 标签样式 */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            line-height: 1;
        }
        
        .badge-primary {
            background: rgba(79, 70, 229, 0.1);
            color: var(--primary);
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }
        
        /* 订单状态标签 */
        .order-status {
            display: inline-flex;
            align-items: center;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            line-height: 1;
        }
        
        .status-available {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .status-taken {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }
        
        .status-blacklisted {
            background: rgba(124, 58, 237, 0.1);
            color: var(--secondary);
        }
        
        /* 订单卡片 */
        .order-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-bottom: 20px;
            transition: var(--transition);
            border-left: 4px solid var(--primary);
        }
        
        .order-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-lg);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .order-id {
            font-weight: 600;
            color: var(--dark);
            font-size: 1.1rem;
        }
        
        .order-price {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin: 15px 0;
            font-feature-settings: "tnum";
        }
        
        .order-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .order-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .order-meta-item i {
            font-size: 0.9rem;
            color: var(--primary);
        }
        
        .order-desc {
            color: var(--gray);
            font-size: 0.95rem;
            margin: 15px 0;
            padding: 15px;
            background: var(--light-gray);
            border-radius: var(--border-radius-sm);
            line-height: 1.6;
        }
        
        /* 日志样式 */
        .log-entry {
            padding: 12px 15px;
            margin: 8px 0;
            border-radius: var(--border-radius-sm);
            background: var(--light-gray);
            animation: fadeIn 0.3s ease forwards;
            border-left: 3px solid var(--primary);
            font-size: 0.9rem;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .log-time {
            color: var(--gray);
            font-weight: 500;
            font-size: 0.8rem;
            white-space: nowrap;
            margin-top: 2px;
        }
        
        .log-message {
            flex: 1;
        }
        
        .success {
            color: var(--success);
        }
        
        .info {
            color: var(--info);
        }
        
        .warning {
            color: var(--warning);
        }
        
        .error {
            color: var(--danger);
        }
        
        /* 关键词选择 */
        .keywords-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 10px;
        }
        
        .keyword-card {
            padding: 12px;
            background: var(--light-gray);
            border-radius: var(--border-radius-sm);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .keyword-card:hover {
            background: rgba(79, 70, 229, 0.05);
            border-color: rgba(79, 70, 229, 0.2);
        }
        
        .keyword-card.selected {
            background: rgba(79, 70, 229, 0.1);
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .keyword-card.selected::after {
            content: '✓';
            position: absolute;
            top: 5px;
            right: 5px;
            color: var(--primary);
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .key {
            display: inline-block;
            width: 28px;
            height: 28px;
            line-height: 28px;
            text-align: center;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3);
            transition: var(--transition);
        }
        
        .keyword-card.selected .key {
            background: var(--secondary);
        }
        
        /* 响应式调整 */
        @media (max-width: 1200px) {
            .keywords-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .header {
                left: 0;
            }
            
            .page-title {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .keywords-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .content-wrapper {
                padding: 20px;
            }
        }
        
        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .keywords-grid {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .page-actions {
                width: 100%;
                flex-direction: column;
                gap: 10px;
            }
            
            .btn-block {
                width: 100%;
            }
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
        /* 加载动画 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(79, 70, 229, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 3rem;
            color: var(--light-gray);
            margin-bottom: 20px;
        }
        
        .empty-state p {
            font-size: 1.1rem;
            margin-top: 15px;
        }
        
        /* 密码输入框 */
        .password-container {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }
        
        .toggle-password:hover {
            color: var(--primary);
        }
        
        /* 状态指示器 */
        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            border-radius: var(--border-radius-sm);
            margin: 25px 0;
            background: var(--light-gray);
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .indicator-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--gray);
            transition: var(--transition);
        }
        
        .indicator-dot.active {
            background: var(--success);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.3);
            animation: pulse 2s infinite;
        }
        
        .indicator-dot.paused {
            background: var(--warning);
            box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.3);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        
        /* 进度条 */
        .progress-bar {
            height: 6px;
            background: var(--light-gray);
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        /* 下拉菜单 */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--white);
            border-radius: var(--border-radius-sm);
            box-shadow: var(--box-shadow-lg);
            min-width: 180px;
            z-index: 1000;
            display: none;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .dropdown-menu.show {
            display: block;
        }
        
        .dropdown-item {
            padding: 10px 15px;
            display: block;
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .dropdown-item:hover {
            background: var(--light-gray);
        }
        
        /* Select2 自定义样式 */
        .select2-container--default .select2-selection--single {
            height: auto;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius-sm);
            background: var(--white);
        }
        
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 100%;
            right: 10px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 1.5;
            padding-left: 0;
        }
        
        .select2-container--default .select2-results__option--highlighted[aria-selected] {
            background-color: var(--primary);
        }
        
        /* 通知系统 */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
            max-width: 350px;
            width: 100%;
        }
        
        .notification {
            padding: 15px 20px;
            border-radius: var(--border-radius-sm);
            box-shadow: var(--box-shadow-lg);
            background: var(--white);
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: slideIn 0.3s ease forwards;
            position: relative;
            overflow: hidden;
        }
        
        .notification.hide {
            animation: slideOut 0.3s ease forwards;
        }
        
        .notification::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            width: 100%;
            background: var(--primary);
            animation: progressBar 3s linear forwards;
        }
        
        .notification-success::after {
            background: var(--success);
        }
        
        .notification-warning::after {
            background: var(--warning);
        }
        
        .notification-error::after {
            background: var(--danger);
        }
        
        @keyframes progressBar {
            0% { width: 100%; }
            100% { width: 0%; }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .notification-icon {
            font-size: 1.2rem;
            margin-top: 2px;
        }
        
        .notification-success .notification-icon {
            color: var(--success);
        }
        
        .notification-warning .notification-icon {
            color: var(--warning);
        }
        
        .notification-error .notification-icon {
            color: var(--danger);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .notification-message {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .notification-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1rem;
            padding: 0;
            margin-left: 10px;
        }
        
        /* 模态框 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1050;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-slow);
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-dialog {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            width: 100%;
            max-width: 500px;
            margin: 20px;
            transform: translateY(20px);
            transition: var(--transition-slow);
        }
        
        .modal.show .modal-dialog {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            padding: 0;
        }
        
        /* 选项卡 */
        .nav-tabs {
            display: flex;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .nav-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray);
            border-bottom: 2px solid transparent;
            transition: var(--transition);
        }
        
        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .nav-tab:hover:not(.active) {
            color: var(--dark);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* 工具提示 */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark);
            color: var(--white);
            text-align: center;
            border-radius: var(--border-radius-sm);
            padding: 8px 12px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: var(--transition);
            font-size: 0.85rem;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* 开关按钮 */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: var(--transition);
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
    </style>
</head>
<body>
    <!-- 通知容器 -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <!-- 侧边导航 -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="#" class="sidebar-brand">
                <i class="fas fa-gamepad"></i>
                <span>电竞抢单系统</span>
            </a>
        </div>
        
        <div class="sidebar-menu">
            <div class="menu-title">主菜单</div>
            <a href="#" class="menu-item active">
                <i class="fas fa-tachometer-alt"></i>
                <span>控制面板</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-list"></i>
                <span>订单管理</span>
                <span class="menu-badge">12</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-cog"></i>
                <span>系统设置</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-chart-line"></i>
                <span>数据分析</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-users"></i>
                <span>用户管理</span>
            </a>
            
            <div class="menu-title">系统</div>
            <a href="#" class="menu-item">
                <i class="fas fa-question-circle"></i>
                <span>帮助中心</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>退出登录</span>
            </a>
        </div>
    </aside>
    
    <!-- 主内容区域 -->
    <main class="main-content">
        <!-- 顶部导航 -->
        <header class="header">
            <div class="header-left">
                <button class="btn btn-outline btn-sm" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="dropdown" style="margin-left: 15px;">
                    <button class="btn btn-outline btn-sm">
                        <i class="fas fa-plus"></i> 快速操作
                        <i class="fas fa-chevron-down" style="margin-left: 5px;"></i>
                    </button>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item" id="quickStartBtn"><i class="fas fa-play"></i> 开始抢单</a>
                        <a href="#" class="dropdown-item" id="quickStopBtn"><i class="fas fa-stop"></i> 停止抢单</a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item"><i class="fas fa-sync-alt"></i> 刷新订单</a>
                    </div>
                </div>
            </div>
            
            <div class="header-right">
                <div class="dropdown">
                    <button class="btn btn-outline btn-sm">
                        <i class="fas fa-bell"></i>
                        <span class="badge badge-danger">3</span>
                    </button>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item">新订单 #12345</a>
                        <a href="#" class="dropdown-item">系统更新可用</a>
                        <a href="#" class="dropdown-item">账户设置完成</a>
                    </div>
                </div>
                
                <div class="dropdown">
                    <div class="user-profile">
                        <div class="user-avatar">A</div>
                        <div>
                            <div class="user-name">管理员</div>
                            <div class="user-role">超级管理员</div>
                        </div>
                        <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                    </div>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item"><i class="fas fa-user"></i> 个人资料</a>
                        <a href="#" class="dropdown-item"><i class="fas fa-cog"></i> 账户设置</a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item"><i class="fas fa-sign-out-alt"></i> 退出登录</a>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- 内容区域 -->
        <div class="content-wrapper">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-bolt"></i> 抢单控制面板
                </h1>
                <div class="page-actions">
                    <button class="btn btn-outline" id="settingsBtn">
                        <i class="fas fa-cog"></i> 高级设置
                    </button>
                    <button class="btn btn-primary" id="helpBtn">
                        <i class="fas fa-question-circle"></i> 帮助文档
                    </button>
                </div>
            </div>
            
            <!-- 统计卡片 -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="successCount">0</div>
                    <div class="stat-label">成功抢单</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i> 12% 较上周
                    </div>
                    <i class="fas fa-check-circle stat-icon"></i>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="attemptCount">0</div>
                    <div class="stat-label">尝试次数</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i> 8% 较上周
                    </div>
                    <i class="fas fa-sync-alt stat-icon"></i>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="orderCount">0</div>
                    <div class="stat-label">订单总数</div>
                    <div class="stat-trend trend-down">
                        <i class="fas fa-arrow-down"></i> 5% 较上周
                    </div>
                    <i class="fas fa-list-alt stat-icon"></i>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="blacklistCount">0</div>
                    <div class="stat-label">黑名单订单</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i> 3% 较上周
                    </div>
                    <i class="fas fa-ban stat-icon"></i>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-8">
                    <!-- 图表区域 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-line"></i> 抢单统计
                            </h3>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline" id="chartRangeBtn">
                                    最近7天 <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu" id="chartRangeMenu">
                                    <a href="#" class="dropdown-item" data-range="7">最近7天</a>
                                    <a href="#" class="dropdown-item" data-range="30">最近30天</a>
                                    <a href="#" class="dropdown-item" data-range="90">最近90天</a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="orderChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 订单列表 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-list"></i> 最新订单
                            </h3>
                            <div>
                                <button class="btn btn-sm btn-outline" id="refreshOrdersBtn">
                                    <i class="fas fa-sync-alt"></i> 刷新
                                </button>
                                <div class="dropdown" style="display: inline-block;">
                                    <button class="btn btn-sm btn-outline">
                                        <i class="fas fa-filter"></i> 筛选
                                        <i class="fas fa-chevron-down" style="margin-left: 5px;"></i>
                                    </button>
                                    <div class="dropdown-menu">
                                        <a href="#" class="dropdown-item" data-filter="all">全部订单</a>
                                        <a href="#" class="dropdown-item" data-filter="available">可抢订单</a>
                                        <a href="#" class="dropdown-item" data-filter="taken">已抢订单</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>订单ID</th>
                                            <th>类型</th>
                                            <th>价格</th>
                                            <th>区域</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orderTableBody">
                                        <tr>
                                            <td colspan="6">
                                                <div class="empty-state">
                                                    <i class="fas fa-spinner fa-spin"></i>
                                                    <p>正在加载订单数据...</p>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <!-- 抢单配置 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-cog"></i> 抢单配置
                            </h3>
                            <div>
                                <button class="btn btn-sm btn-outline" id="saveConfigBtn">
                                    <i class="fas fa-save"></i> 保存
                                </button>
                                <button class="btn btn-sm btn-outline" id="loadConfigBtn">
                                    <i class="fas fa-folder-open"></i> 加载
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="nav-tabs">
                                <div class="nav-tab active" data-tab="basic">基本设置</div>
                                <div class="nav-tab" data-tab="advanced">高级设置</div>
                            </div>
                            
                            <div class="tab-content active" id="basicTab">
                                <div class="form-group">
                                    <label class="form-label">会员ID (memberId)</label>
                                    <div class="password-container">
                                        <input type="password" class="form-control" id="memberId" placeholder="请输入会员ID">
                                        <i class="fas fa-eye toggle-password" id="toggleMemberId"></i>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">打手ID (ids)</label>
                                    <div class="password-container">
                                        <input type="password" class="form-control" id="ids" placeholder="请输入打手ID">
                                        <i class="fas fa-eye toggle-password" id="toggleIds"></i>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">昵称 (nickname)</label>
                                    <div class="password-container">
                                        <input type="password" class="form-control" id="nickname" placeholder="请输入昵称">
                                        <i class="fas fa-eye toggle-password" id="toggleNickname"></i>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">访问令牌 (token)</label>
                                    <div class="password-container">
                                        <input type="password" class="form-control" id="token" placeholder="请输入访问令牌">
                                        <i class="fas fa-eye toggle-password" id="toggleToken"></i>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">区域筛选</label>
                                    <select class="form-control form-select" id="areaFilter">
                                        <option value="all">全选</option>
                                        <option value="q">Q区</option>
                                        <option value="v">V区</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">关键词选择 <span class="badge badge-primary">最多选择5个</span></label>
                                    <div class="keywords-grid" id="keywordsContainer">
                                        <div class="keyword-card" data-key="1">
                                            <div class="key">1</div>
                                            <div>开荒单</div>
                                        </div>
                                        <div class="keyword-card" data-key="2">
                                            <div class="key">2</div>
                                            <div>暑假快乐单</div>
                                        </div>
                                        <div class="keyword-card" data-key="3">
                                            <div class="key">3</div>
                                            <div>护航加强单</div>
                                        </div>
                                        <div class="keyword-card" data-key="4">
                                            <div class="key">4</div>
                                            <div>实验基地专属</div>
                                        </div>
                                        <div class="keyword-card" data-key="5">
                                            <div class="key">5</div>
                                            <div>烽火荣都专属</div>
                                        </div>
                                        <div class="keyword-card" data-key="6">
                                            <div class="key">6</div>
                                            <div>冰河禁区专属</div>
                                        </div>
                                        <div class="keyword-card" data-key="8">
                                            <div class="key">8</div>
                                            <div>钻石加强单</div>
                                        </div>
                                        <div class="keyword-card" data-key="9">
                                            <div class="key">9</div>
                                            <div>金色狗牌单</div>
                                        </div>
                                        <div class="keyword-card" data-key="10">
                                            <div class="key">10</div>
                                            <div>保底BOSS金光单</div>
                                        </div>
                                        <div class="keyword-card" data-key="11">
                                            <div class="key">11</div>
                                            <div>大神护航单</div>
                                        </div>
                                        <div class="keyword-card" data-key="12">
                                            <div class="key">12</div>
                                            <div>苏尔南钻石单</div>
                                        </div>
                                        <div class="keyword-card" data-key="13">
                                            <div class="key">13</div>
                                            <div>苏尔南清图单</div>
                                        </div>
                                        <div class="keyword-card" data-key="14">
                                            <div class="key">14</div>
                                            <div>给打手喝奶茶</div>
                                        </div>
                                        <div class="keyword-card" data-key="16">
                                            <div class="key">15</div>
                                            <div>给打手加鸡腿</div>
                                        </div>
                                        <div class="keyword-card" data-key="17">
                                            <div class="key">17</div>
                                            <div>给打手加汉堡</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="tab-content" id="advancedTab">
                                <div class="form-group">
                                    <label class="form-label">抢单延迟 (毫秒)</label>
                                    <input type="number" class="form-control" id="delay" value="300" min="100" max="1000">
                                    <div class="progress-bar">
                                        <div class="progress" style="width: 30%;"></div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">刷新频率 (秒)</label>
                                    <input type="number" class="form-control" id="refreshRate" value="1.0" step="0.1" min="0.5" max="5">
                                    <div class="progress-bar">
                                        <div class="progress" style="width: 20%;"></div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">自动重试次数</label>
                                    <input type="number" class="form-control" id="retryCount" value="3" min="0" max="10">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">自动停止设置</label>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <label class="switch">
                                            <input type="checkbox" id="autoStopToggle" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>抢单成功后自动停止</span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">黑名单设置</label>
                                    <select class="form-control form-select" id="blacklistStrategy">
                                        <option value="auto">自动检测已抢订单</option>
                                        <option value="manual">仅手动添加</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="status-indicator">
                                <div class="indicator-dot" id="statusDot"></div>
                                <span id="statusText">准备就绪</span>
                            </div>
                            
                            <div class="form-group" style="margin-top: 20px;">
                                <button class="btn btn-success btn-block" id="startBtn">
                                    <i class="fas fa-play"></i> 开始抢单
                                </button>
                                <button class="btn btn-danger btn-block" id="stopBtn" disabled>
                                    <i class="fas fa-stop"></i> 停止抢单
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 抢单日志 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-clipboard-list"></i> 抢单日志
                            </h3>
                            <div>
                                <span class="badge badge-primary" id="logCount">2</span>
                                <button class="btn btn-sm btn-outline" id="clearLogsBtn" style="margin-left: 10px;">
                                    <i class="fas fa-trash"></i> 清空
                                </button>
                            </div>
                        </div>
                        <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                            <div id="logContainer">
                                <div class="log-entry">
                                    <span class="log-time">[系统]</span>
                                    <span class="log-message info">系统初始化完成，准备就绪</span>
                                </div>
                                <div class="log-entry">
                                    <span class="log-time">[提示]</span>
                                    <span class="log-message info">请配置您的账户信息并点击"开始抢单"按钮</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 高级设置模态框 -->
    <div class="modal" id="settingsModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-cog"></i> 高级设置</h3>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">API端点</label>
                    <input type="text" class="form-control" id="apiEndpoint" value="https://paidan.xlt666.club/yxdl/api">
                </div>
                
                <div class="form-group">
                    <label class="form-label">请求超时 (秒)</label>
                    <input type="number" class="form-control" id="requestTimeout" value="10" min="1" max="30">
                </div>
                
                <div class="form-group">
                    <label class="form-label">并发请求数</label>
                    <input type="number" class="form-control" id="concurrentRequests" value="3" min="1" max="10">
                </div>
                
                <div class="form-group">
                    <label class="form-label">通知设置</label>
                    <div style="margin-top: 10px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <label class="switch">
                                <input type="checkbox" id="soundToggle" checked>
                                <span class="slider"></span>
                            </label>
                            <span>启用声音通知</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label class="switch">
                                <input type="checkbox" id="desktopNotifyToggle" checked>
                                <span class="slider"></span>
                            </label>
                            <span>启用桌面通知</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelSettingsBtn">取消</button>
                <button class="btn btn-primary" id="saveSettingsBtn">保存设置</button>
            </div>
        </div>
    </div>

    <!-- 帮助文档模态框 -->
    <div class="modal" id="helpModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-question-circle"></i> 帮助文档</h3>
                <button class="modal-close" id="closeHelpModal">&times;</button>
            </div>
            <div class="modal-body">
                <h4 style="margin-bottom: 15px;">使用指南</h4>
                <div style="margin-bottom: 20px;">
                    <h5 style="margin-bottom: 10px; color: var(--primary);">1. 基本配置</h5>
                    <p style="margin-bottom: 10px;">填写正确的会员ID、打手ID、昵称和访问令牌，这些信息是抢单的基础。</p>
                    <p style="margin-bottom: 10px;">选择您要关注的订单区域（Q区或V区）。</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h5 style="margin-bottom: 10px; color: var(--primary);">2. 关键词选择</h5>
                    <p style="margin-bottom: 10px;">系统提供了16种预设关键词，您可以选择最多5个关键词来过滤特定类型的订单。</p>
                    <p style="margin-bottom: 10px;">点击关键词卡片可以选中或取消选中。</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h5 style="margin-bottom: 10px; color: var(--primary);">3. 抢单设置</h5>
                    <p style="margin-bottom: 10px;">抢单延迟：设置抢单前的等待时间（100-1000毫秒）。</p>
                    <p style="margin-bottom: 10px;">刷新频率：设置系统检查新订单的频率（0.5-5秒）。</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h5 style="margin-bottom: 10px; color: var(--primary);">4. 高级功能</h5>
                    <p style="margin-bottom: 10px;">自动重试：设置抢单失败后的自动重试次数。</p>
                    <p style="margin-bottom: 10px;">黑名单策略：选择如何处理已被抢的订单。</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="closeHelpBtn">关闭</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        // API配置
        const BASE_URL = "https://paidan.xlt666.club/yxdl/api";
        const ORDER_LIST_URL = `${BASE_URL}/order/list?pageSize=50&pageNum=1&categoryId=0`;
        const TAKE_ORDER_URL = `${BASE_URL}/order/takeOrder`;
        const ORDER_DETAIL_URL = `${BASE_URL}/order/getInfo`;
        const SUCCESS_SOUND_URL = "https://lv521314.github.io/xiaodao/0.mp3";
        
        // DOM元素
        const logContainer = document.getElementById('logContainer');
        const successCount = document.getElementById('successCount');
        const attemptCount = document.getElementById('attemptCount');
        const orderCount = document.getElementById('orderCount');
        const blacklistCount = document.getElementById('blacklistCount');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const orderTableBody = document.getElementById('orderTableBody');
        const logCount = document.getElementById('logCount');
        const delayInput = document.getElementById('delay');
        const refreshRateInput = document.getElementById('refreshRate');
        const toggleMemberId = document.getElementById('toggleMemberId');
        const toggleIds = document.getElementById('toggleIds');
        const toggleNickname = document.getElementById('toggleNickname');
        const toggleToken = document.getElementById('toggleToken');
        const memberIdInput = document.getElementById('memberId');
        const idsInput = document.getElementById('ids');
        const nicknameInput = document.getElementById('nickname');
        const tokenInput = document.getElementById('token');
        const saveConfigBtn = document.getElementById('saveConfigBtn');
        const loadConfigBtn = document.getElementById('loadConfigBtn');
        const refreshOrdersBtn = document.getElementById('refreshOrdersBtn');
        const clearLogsBtn = document.getElementById('clearLogsBtn');
        const keywordsContainer = document.getElementById('keywordsContainer');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.querySelector('.sidebar');
        const settingsBtn = document.getElementById('settingsBtn');
        const helpBtn = document.getElementById('helpBtn');
        const settingsModal = document.getElementById('settingsModal');
        const helpModal = document.getElementById('helpModal');
        const closeSettingsModal = document.getElementById('closeSettingsModal');
        const closeHelpModal = document.getElementById('closeHelpModal');
        const cancelSettingsBtn = document.getElementById('cancelSettingsBtn');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const closeHelpBtn = document.getElementById('closeHelpBtn');
        const quickStartBtn = document.getElementById('quickStartBtn');
        const quickStopBtn = document.getElementById('quickStopBtn');
        const notificationContainer = document.getElementById('notificationContainer');
        
        // 状态变量
        let isRunning = false;
        let isGrabbing = false;
        let currentOrder = null;
        let intervalId = null;
        let stats = {
            success: 0,
            attempts: 0,
            orders: 0,
            blacklist: 0
        };
        let config = {
            memberId: '',
            ids: '',
            nickname: '',
            token: '',
            areaFilter: 'all',
            keywords: [],
            delay: 300,
            refreshRate: 1.0,
            autoStop: true,
            blacklistStrategy: 'auto',
            retryCount: 3
        };
        let orderBlacklist = [];
        let selectedKeywords = new Set();
        let logEntries = 2; // 初始日志条目数
        let orderChart = null;
        
        // 音频对象
        const successSound = new Audio(SUCCESS_SOUND_URL);
        
        // 初始化图表
        function initChart() {
            const ctx = document.getElementById('orderChart').getContext('2d');
            orderChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '成功抢单',
                        data: [],
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.3,
                        fill: true,
                        borderWidth: 2
                    }, {
                        label: '尝试抢单',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.3,
                        fill: true,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#1e1b4b',
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 13
                            },
                            padding: 12,
                            cornerRadius: 8
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }
        
        // 显示通知
        function showNotification(title, message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            const iconClass = type === 'success' ? 'fa-check-circle' : 
                             type === 'warning' ? 'fa-exclamation-triangle' : 
                             type === 'error' ? 'fa-times-circle' : 'fa-info-circle';
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas ${iconClass}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            notificationContainer.appendChild(notification);
            
            // 自动关闭通知
            setTimeout(() => {
                notification.classList.add('hide');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
            
            // 点击关闭按钮
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.classList.add('hide');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            });
        }
        
        // 切换密码可见性
        function setupPasswordToggles() {
            toggleMemberId.addEventListener('click', () => {
                const type = memberIdInput.getAttribute('type') === 'password' ? 'text' : 'password';
                memberIdInput.setAttribute('type', type);
                toggleMemberId.classList.toggle('fa-eye');
                toggleMemberId.classList.toggle('fa-eye-slash');
            });
            
            toggleIds.addEventListener('click', () => {
                const type = idsInput.getAttribute('type') === 'password' ? 'text' : 'password';
                idsInput.setAttribute('type', type);
                toggleIds.classList.toggle('fa-eye');
                toggleIds.classList.toggle('fa-eye-slash');
            });
            
            toggleNickname.addEventListener('click', () => {
                const type = nicknameInput.getAttribute('type') === 'password' ? 'text' : 'password';
                nicknameInput.setAttribute('type', type);
                toggleNickname.classList.toggle('fa-eye');
                toggleNickname.classList.toggle('fa-eye-slash');
            });
            
            toggleToken.addEventListener('click', () => {
                const type = tokenInput.getAttribute('type') === 'password' ? 'text' : 'password';
                tokenInput.setAttribute('type', type);
                toggleToken.classList.toggle('fa-eye');
                toggleToken.classList.toggle('fa-eye-slash');
            });
        }
        
        // 保存配置到本地存储
        function saveConfigToLocal() {
            const configToSave = {
                memberId: memberIdInput.value,
                ids: idsInput.value,
                nickname: nicknameInput.value,
                token: tokenInput.value,
                areaFilter: document.getElementById('areaFilter').value,
                keywords: Array.from(selectedKeywords),
                delay: delayInput.value,
                refreshRate: refreshRateInput.value,
                autoStop: document.getElementById('autoStopToggle').checked,
                blacklistStrategy: document.getElementById('blacklistStrategy').value,
                retryCount: document.getElementById('retryCount').value
            };
            
            try {
                localStorage.setItem('xltConfig', JSON.stringify(configToSave));
                addLog('✅ 所有配置已成功保存到本地浏览器！', 'success');
                showNotification('配置保存成功', '您的设置已保存到本地浏览器', 'success');
            } catch (e) {
                addLog('❌ 保存配置失败：' + e.message, 'error');
                showNotification('配置保存失败', e.message, 'error');
            }
        }
        
        // 从本地存储加载配置
        function loadConfigFromLocal() {
            const savedConfig = localStorage.getItem('xltConfig');
            if (!savedConfig) {
                addLog('⚠️ 没有找到已保存的配置', 'warning');
                showNotification('配置加载失败', '没有找到已保存的配置', 'warning');
                return;
            }
            
            try {
                const config = JSON.parse(savedConfig);
                
                // 恢复输入框值
                memberIdInput.value = config.memberId || '';
                idsInput.value = config.ids || '';
                nicknameInput.value = config.nickname || '';
                tokenInput.value = config.token || '';
                
                // 恢复数字输入项
                delayInput.value = config.delay || 300;
                refreshRateInput.value = config.refreshRate || 1.0;
                document.getElementById('retryCount').value = config.retryCount || 3;
                
                // 触发进度条更新
                delayInput.dispatchEvent(new Event('input'));
                refreshRateInput.dispatchEvent(new Event('input'));
                
                // 恢复下拉选择
                if (config.areaFilter) {
                    document.getElementById('areaFilter').value = config.areaFilter;
                }
                
                if (config.blacklistStrategy) {
                    document.getElementById('blacklistStrategy').value = config.blacklistStrategy;
                }
                
                // 恢复开关状态
                document.getElementById('autoStopToggle').checked = config.autoStop !== false;
                
                // 恢复关键词选择
                clearAllKeywords();
                if (config.keywords && config.keywords.length > 0) {
                    config.keywords.forEach(key => {
                        const card = document.querySelector(`.keyword-card[data-key="${key}"]`);
                        if (card) {
                            card.classList.add('selected');
                            selectedKeywords.add(key);
                        }
                    });
                }
        
                addLog('✅ 配置已成功从本地浏览器加载！', 'success');
                showNotification('配置加载成功', '您的设置已从本地浏览器恢复', 'success');
            } catch (e) {
                addLog('❌ 加载配置失败：' + e.message, 'error');
                showNotification('配置加载失败', e.message, 'error');
            }
        }
        
        // 清除所有已选关键词
        function clearAllKeywords() {
            document.querySelectorAll('.keyword-card.selected').forEach(card => {
                card.classList.remove('selected');
            });
            selectedKeywords.clear();
        }
        
        // 更新黑名单显示
        function updateBlacklistDisplay() {
            blacklistCount.textContent = orderBlacklist.length;
            stats.blacklist = orderBlacklist.length;
        }
        
        // 添加日志
        function addLog(message, type = 'info', orderId = null) {
            if (orderId && orderBlacklist.includes(orderId)) {
                return;
            }
            
            const now = new Date();
            const timeString = `[${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}]`;
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            const typeClass = type === 'success' ? 'success' : 
                             type === 'warning' ? 'warning' : 
                             type === 'error' ? 'error' : 'info';
            
            logEntry.innerHTML = `
                <span class="log-time">${timeString}</span>
                <span class="log-message ${typeClass}">${message}</span>
            `;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // 更新日志计数
            logEntries++;
            logCount.textContent = logEntries;
        }
        
        // 清空日志
        function clearLogs() {
            logContainer.innerHTML = '';
            logEntries = 0;
            logCount.textContent = '0';
            addLog('日志已清空', 'info');
        }
        
        // 更新统计
        function updateStats() {
            successCount.textContent = stats.success;
            attemptCount.textContent = stats.attempts;
            orderCount.textContent = stats.orders;
            blacklistCount.textContent = stats.blacklist;
        }
        
        // 关键词选择
        function setupKeywordSelection() {
            const keywordCards = document.querySelectorAll('.keyword-card');
            
            keywordCards.forEach(card => {
                card.addEventListener('click', () => {
                    const key = card.dataset.key;
                    
                    if (selectedKeywords.has(key)) {
                        selectedKeywords.delete(key);
                        card.classList.remove('selected');
                    } else {
                        if (selectedKeywords.size >= 5) {
                            showNotification('关键词选择', '最多只能选择5个关键词', 'warning');
                            return;
                        }
                        selectedKeywords.add(key);
                        card.classList.add('selected');
                    }
                    
                    config.keywords = Array.from(selectedKeywords).map(k => {
                        const card = document.querySelector(`.keyword-card[data-key="${k}"]`);
                        return card.querySelector('div:last-child').textContent;
                    });
                });
            });
        }
        
        // 播放成功音效
        function playSuccessSound() {
            if (document.getElementById('soundToggle').checked) {
                successSound.currentTime = 0;
                successSound.play();
            }
        }
        
        // 获取可用订单
        async function getAvailableOrders() {
            const token = config.token;
            
            if (!token) {
                addLog('❌ Token未配置，无法获取订单', 'error');
                showNotification('获取订单失败', 'Token未配置', 'error');
                return [];
            }
            
            try {
                addLog('🔍 正在获取订单列表...', 'info');
                
                const response = await fetch(ORDER_LIST_URL, {
                    headers: { 'token': token }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP错误! 状态: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.code !== 200) {
                    addLog(`❌ 获取订单失败: ${data.msg || '未知错误'}`, 'error');
                    showNotification('获取订单失败', data.msg || '未知错误', 'error');
                    return [];
                }
                
                stats.orders = data.rows.length;
                updateStats();
                
                // 过滤订单
                let filteredOrders = data.rows.filter(order => {
                    const categoryName = order.categoryName.toLowerCase();
                    
                    // 区域筛选
                    if (config.areaFilter === 'q' && !categoryName.includes('q区')) {
                        return false;
                    }
                    if (config.areaFilter === 'v' && !categoryName.includes('v区')) {
                        return false;
                    }
                    
                    // 关键词筛选
                    if (config.keywords.length > 0) {
                        const taskName = order.taskName.toLowerCase();
                        const description = order.description.toLowerCase();
                        
                        return config.keywords.some(keyword => {
                            const kw = keyword.toLowerCase();
                            return taskName.includes(kw) || description.includes(kw);
                        });
                    }
                    
                    return true;
                });
                
                // 更新界面上的订单列表
                updateOrderTable(filteredOrders);
                
                return filteredOrders;
            } catch (error) {
                addLog(`❌ 获取订单出错: ${error.message}`, 'error');
                showNotification('获取订单失败', error.message, 'error');
                return [];
            }
        }
        
        // 更新订单表格
        async function updateOrderTable(orders) {
            if (orders.length === 0) {
                orderTableBody.innerHTML = `
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <i class="fas fa-box-open"></i>
                                <p>当前没有可抢订单</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            let availableCount = 0;
            
            // 并行获取订单详情
            const orderDetails = await Promise.all(orders.map(async order => {
                const isBlacklisted = orderBlacklist.includes(order.taskId);
                const detail = isBlacklisted ? null : await getOrderDetail(order.taskId);
                return {
                    ...order,
                    isBlacklisted,
                    isTaken: detail ? detail.isTaken : true
                };
            }));
            
            // 生成订单表格HTML
            orderDetails.forEach(order => {
                if (!order.isBlacklisted && !order.isTaken) {
                    availableCount++;
                    html += `
                        <tr>
                            <td>#${order.taskId}</td>
                            <td>${order.taskName || '未知类型'}</td>
                            <td style="font-weight: 600; color: var(--primary);">¥${order.receivePrice.toFixed(2)}</td>
                            <td>${order.categoryName}</td>
                            <td><span class="order-status status-available">可抢</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline" data-id="${order.taskId}">
                                    <i class="fas fa-hand-paper"></i> 抢单
                                </button>
                            </td>
                        </tr>
                    `;
                } else if (order.isBlacklisted) {
                    html += `
                        <tr>
                            <td>#${order.taskId}</td>
                            <td>${order.taskName || '未知类型'}</td>
                            <td style="font-weight: 600; color: var(--danger);">¥${order.receivePrice.toFixed(2)}</td>
                            <td>${order.categoryName}</td>
                            <td><span class="order-status status-blacklisted">黑名单</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline" disabled>
                                    <i class="fas fa-ban"></i> 不可抢
                                </button>
                            </td>
                        </tr>
                    `;
                } else {
                    html += `
                        <tr>
                            <td>#${order.taskId}</td>
                            <td>${order.taskName || '未知类型'}</td>
                            <td style="font-weight: 600; color: var(--danger);">¥${order.receivePrice.toFixed(2)}</td>
                            <td>${order.categoryName}</td>
                            <td><span class="order-status status-taken">已抢</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline" disabled>
                                    <i class="fas fa-times"></i> 已抢
                                </button>
                            </td>
                        </tr>
                    `;
                }
            });
            
            stats.orders = availableCount;
            updateStats();
            
            if (availableCount === 0 && orderDetails.length > 0) {
                html = `
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <i class="fas fa-clock"></i>
                                <p>当前没有可抢订单，请稍后再试</p>
                            </div>
                        </td>
                    </tr>
                `;
            } else if (orderDetails.length === 0) {
                html = `
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <i class="fas fa-box-open"></i>
                                <p>当前没有可抢订单</p>
                            </div>
                        </td>
                    </tr>
                `;
            }
            
            orderTableBody.innerHTML = html;
            
            // 绑定抢单按钮事件
            document.querySelectorAll('[data-id]').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const taskId = this.getAttribute('data-id');
                    const order = orders.find(o => o.taskId == taskId);
                    if (order) {
                        await manualTakeOrder(order);
                    }
                });
            });
        }
        
        // 获取订单详情
        async function getOrderDetail(taskId) {
            const detailUrl = `${ORDER_DETAIL_URL}?taskId=${taskId}`;
            
            try {
                const response = await fetch(detailUrl, {
                    headers: { 'token': config.token }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP错误! 状态: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.code === 200 && result.data) {
                    // 判断订单是否已被抢
                    const isTaken = result.data.isTake === 1;
                    
                    return {
                        isTaken: isTaken,
                        description: result.data.taskName || '未知类型',
                        receivePrice: result.data.receivePrice || '未知发单金额',
                        createTime: result.data.createTime || '未知发单时间'
                    };
                }
            } catch (error) {
                addLog(`⚠️ 获取订单详情失败: ${error.message}`, 'warning', taskId);
            }
            
            return null;
        }
        
        // 抢单功能
        async function takeOrder(taskId) {
            if (isGrabbing) {
                addLog(`⚠️ 当前有订单正在处理中，请等待完成`, 'warning');
                showNotification('抢单进行中', '当前有订单正在处理中，请等待完成', 'warning');
                return false;
            }
            
            isGrabbing = true;
            stats.attempts++;
            updateStats();
            
            const delay = config.delay;
            addLog(`▶ 开始处理订单 #${taskId}，等待 ${delay}ms 后抢单...`, 'info');
            showNotification('抢单开始', `正在处理订单 #${taskId}`, 'info');
            
            // 模拟延迟
            await new Promise(resolve => setTimeout(resolve, delay));
            
            try {
                const response = await fetch(TAKE_ORDER_URL, {
                    method: 'POST',
                    headers: {
                        'token': config.token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        taskId: taskId,
                        memberId: config.memberId,
                        ids: [config.ids],
                        nickname: config.nickname,
                        avatar: "https://xiaolatiao.oss-cn-beijing.aliyuncs.com/uploadImg-test/wYp4xWmXfR.jpg"
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP错误! 状态: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.code === 200) {
                    stats.success++;
                    updateStats();
                    
                    addLog('✅ 抢单成功！', 'success');
                    addLog(`订单ID: ${taskId}`, 'success');
                    
                    // 获取订单详情以显示更多信息
                    const detail = await getOrderDetail(taskId);
                    if (detail) {
                        addLog(`订单类型: ${detail.description}`, 'success');
                        addLog(`发单金额: ¥${detail.receivePrice}`, 'success');
                        addLog(`下单时间: ${detail.createTime}`, 'success');
                    }
                    
                    // 播放成功音效
                    playSuccessSound();
                    
                    // 发送桌面通知
                    if (document.getElementById('desktopNotifyToggle').checked) {
                        if (Notification.permission === 'granted') {
                            new Notification('抢单成功', {
                                body: `订单 #${taskId} 已成功抢到！`,
                                icon: 'https://xiaolatiao.oss-cn-beijing.aliyuncs.com/uploadImg-test/wYp4xWmXfR.jpg'
                            });
                        } else if (Notification.permission !== 'denied') {
                            Notification.requestPermission().then(permission => {
                                if (permission === 'granted') {
                                    new Notification('抢单成功', {
                                        body: `订单 #${taskId} 已成功抢到！`,
                                        icon: 'https://xiaolatiao.oss-cn-beijing.aliyuncs.com/uploadImg-test/wYp4xWmXfR.jpg'
                                    });
                                }
                            });
                        }
                    }
                    
                    // 抢单成功后完全停止程序
                    if (config.autoStop) {
                        stopAutoGrab();
                        addLog('🛑 程序已自动停止，请手动重新启动', 'warning');
                    }
                    
                    return true;
                } else {
                    // 检查是否是因为订单已被抢
                    if (result.msg && result.msg.includes('已被抢')) {
                        addLog(`⚠️ 订单 #${taskId} 已被抢走，加入黑名单`, 'warning');
                        showNotification('订单已被抢', `订单 #${taskId} 已被抢走`, 'warning');
                        
                        // 将订单加入黑名单
                        if (!orderBlacklist.includes(taskId) && config.blacklistStrategy === 'auto') {
                            orderBlacklist.push(taskId);
                            updateBlacklistDisplay();
                        }
                    } else {
                        addLog(`❌ 抢单失败: ${result.msg || '未知错误'}`, 'error');
                        showNotification('抢单失败', result.msg || '未知错误', 'error');
                    }
                    return false;
                }
            } catch (error) {
                addLog(`❗ 抢单过程中出错: ${error.message}`, 'error');
                showNotification('抢单出错', error.message, 'error');
                return false;
            } finally {
                isGrabbing = false;
                currentOrder = null;
            }
        }
        
        // 手动抢单
        async function manualTakeOrder(order) {
            if (!config.token || !config.memberId || !config.ids || !config.nickname) {
                addLog('⚠️ 请先配置所有用户信息', 'warning');
                showNotification('配置不完整', '请填写所有必要的用户信息', 'warning');
                return;
            }
            
            // 停止自动抢单（如果正在运行）
            if (isRunning) {
                stopAutoGrab();
            }
            
            const success = await takeOrder(order.taskId);
            if (success) {
                // 成功后刷新订单列表
                getAvailableOrders();
            }
        }
        
        // 开始自动抢单
        async function startAutoGrab() {
            if (isRunning) return;
            
            // 获取配置
            config = {
                memberId: memberIdInput.value,
                ids: idsInput.value,
                nickname: nicknameInput.value,
                token: tokenInput.value,
                areaFilter: document.getElementById('areaFilter').value,
                keywords: Array.from(selectedKeywords).map(k => {
                    const card = document.querySelector(`.keyword-card[data-key="${k}"]`);
                    return card.querySelector('div:last-child').textContent;
                }),
                delay: parseInt(delayInput.value) || 300,
                refreshRate: parseFloat(refreshRateInput.value) || 1.0,
                autoStop: document.getElementById('autoStopToggle').checked,
                blacklistStrategy: document.getElementById('blacklistStrategy').value,
                retryCount: parseInt(document.getElementById('retryCount').value) || 3
            };
            
            // 验证配置
            if (!config.memberId || !config.ids || !config.nickname || !config.token) {
                addLog('❌ 请填写所有必要的配置信息', 'warning');
                showNotification('配置不完整', '请填写所有必要的用户信息', 'warning');
                return;
            }
            
            isRunning = true;
            statusDot.classList.add('active');
            statusText.textContent = '运行中...';
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            addLog('🚀 自动抢单程序启动', 'success');
            addLog(`区域筛选: ${config.areaFilter === 'all' ? '全选' : config.areaFilter === 'q' ? 'Q区' : 'V区'}`);
            
            if (config.keywords.length > 0) {
                addLog(`关键词: ${config.keywords.join(', ')}`);
            } else {
                addLog('关键词: 无（全选）');
            }
            
            addLog(`抢单延迟: ${config.delay}ms`);
            addLog(`刷新频率: ${config.refreshRate}秒`);
            
            showNotification('抢单启动', '自动抢单程序已启动', 'success');
            
            // 自动抢单循环
            intervalId = setInterval(async () => {
                try {
                    if (isGrabbing) {
                        addLog('⏳ 当前有订单正在处理中，等待处理完成...', 'info');
                        return;
                    }
                    
                    const orders = await getAvailableOrders();
                    
                    if (orders.length === 0) {
                        addLog('🔍 暂无符合条件的订单，继续扫描...', 'info');
                        return;
                    }
                    
                    // 尝试抢单每个符合条件的订单
                    for (const order of orders) {
                        if (!isRunning) break; // 如果已停止则退出
                        
                        // 检查订单是否在黑名单中
                        if (orderBlacklist.includes(order.taskId)) {
                            continue;
                        }
                        
                        // 检查订单是否已被抢
                        const detail = await getOrderDetail(order.taskId);
                        if (detail && detail.isTaken) {
                            // 将订单加入黑名单
                            if (!orderBlacklist.includes(order.taskId) && config.blacklistStrategy === 'auto') {
                                orderBlacklist.push(order.taskId);
                                updateBlacklistDisplay();
                            }
                            continue;
                        }
                        
                        addLog(`🎯 发现新订单 → ${order.taskName}（ID：${order.taskId}）`, 'info');
                        showNotification('发现新订单', `${order.taskName}（ID：${order.taskId}）`, 'info');
                        
                        let retryCount = 0;
                        let success = false;
                        
                        while (retryCount <= config.retryCount && !success) {
                            if (retryCount > 0) {
                                addLog(`🔄 尝试第 ${retryCount} 次重试...`, 'info');
                            }
                            
                            success = await takeOrder(order.taskId);
                            retryCount++;
                            
                            if (!success && retryCount <= config.retryCount) {
                                await new Promise(resolve => setTimeout(resolve, 1000));
                            }
                        }
                        
                        if (success) {
                            // 成功后退出循环（程序会自动停止）
                            break;
                        }
                    }
                } catch (error) {
                    addLog(`⚠️ 自动抢单过程中出错: ${error.message}`, 'error');
                    showNotification('抢单出错', error.message, 'error');
                }
            }, config.refreshRate * 1000);
        }
        
        // 停止自动抢单
        function stopAutoGrab() {
            if (!isRunning) return;
            
            clearInterval(intervalId);
            isRunning = false;
            isGrabbing = false;
            currentOrder = null;
            statusDot.classList.remove('active');
            statusText.textContent = '已停止';
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            addLog('🛑 抢单程序已停止', 'warning');
            showNotification('抢单停止', '自动抢单程序已停止', 'warning');
        }
        
        // 初始化进度条
        function initProgressBars() {
            delayInput.addEventListener('input', function() {
                const value = parseInt(this.value);
                const percentage = ((value - 100) / (1000 - 100)) * 100;
                this.nextElementSibling.querySelector('.progress').style.width = `${percentage}%`;
            });
            
            refreshRateInput.addEventListener('input', function() {
                const value = parseFloat(this.value);
                const percentage = ((value - 0.5) / (5 - 0.5)) * 100;
                this.nextElementSibling.querySelector('.progress').style.width = `${percentage}%`;
            });
            
            // 初始设置
            delayInput.dispatchEvent(new Event('input'));
            refreshRateInput.dispatchEvent(new Event('input'));
        }
        
        // 初始化下拉菜单
        function initDropdowns() {
            document.querySelectorAll('.dropdown').forEach(dropdown => {
                const button = dropdown.querySelector('button');
                const menu = dropdown.querySelector('.dropdown-menu');
                
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    menu.classList.toggle('show');
                });
                
                // 点击菜单项
                menu.querySelectorAll('.dropdown-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        if (item.textContent.includes('最近')) {
                            button.innerHTML = item.textContent + ' <i class="fas fa-chevron-down"></i>';
                        } else if (item.textContent.includes('筛选')) {
                            button.innerHTML = '<i class="fas fa-filter"></i> ' + item.textContent + ' <i class="fas fa-chevron-down"></i>';
                        }
                        menu.classList.remove('show');
                        
                        // 如果是图表范围选择
                        if (item.hasAttribute('data-range')) {
                            updateChartData(parseInt(item.getAttribute('data-range')));
                        }
                        
                        // 如果是订单筛选
                        if (item.hasAttribute('data-filter')) {
                            // 这里可以添加订单筛选逻辑
                        }
                    });
                });
            });
            
            // 点击页面其他地方关闭下拉菜单
            document.addEventListener('click', () => {
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
            });
        }
        
        // 初始化选项卡
        function initTabs() {
            const tabs = document.querySelectorAll('.nav-tab');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // 移除所有选项卡的active类
                    tabs.forEach(t => t.classList.remove('active'));
                    
                    // 添加当前选项卡的active类
                    tab.classList.add('active');
                    
                    // 隐藏所有内容
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // 显示当前选项卡对应的内容
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                });
            });
        }
        
        // 初始化模态框
        function initModals() {
            // 设置模态框
            settingsBtn.addEventListener('click', () => {
                settingsModal.classList.add('show');
            });
            
            closeSettingsModal.addEventListener('click', () => {
                settingsModal.classList.remove('show');
            });
            
            cancelSettingsBtn.addEventListener('click', () => {
                settingsModal.classList.remove('show');
            });
            
            saveSettingsBtn.addEventListener('click', () => {
                // 这里可以添加保存高级设置的逻辑
                settingsModal.classList.remove('show');
                showNotification('设置保存成功', '高级设置已保存', 'success');
            });
            
            // 帮助文档模态框
            helpBtn.addEventListener('click', () => {
                helpModal.classList.add('show');
            });
            
            closeHelpModal.addEventListener('click', () => {
                helpModal.classList.remove('show');
            });
            
            closeHelpBtn.addEventListener('click', () => {
                helpModal.classList.remove('show');
            });
            
            // 点击模态框外部关闭
            window.addEventListener('click', (e) => {
                if (e.target === settingsModal) {
                    settingsModal.classList.remove('show');
                }
                if (e.target === helpModal) {
                    helpModal.classList.remove('show');
                }
            });
        }
        
        // 初始化快捷键
        function initShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Ctrl + S 保存配置
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveConfigToLocal();
                }
                
                // Ctrl + L 加载配置
                if (e.ctrlKey && e.key === 'l') {
                    e.preventDefault();
                    loadConfigFromLocal();
                }
                
                // Ctrl + Space 开始/停止
                if (e.ctrlKey && e.key === ' ') {
                    e.preventDefault();
                    if (isRunning) {
                        stopAutoGrab();
                    } else {
                        startAutoGrab();
                    }
                }
            });
        }
        
        // 初始化
        function init() {
            // 初始化图表
            initChart();
            
            // 绑定按钮事件
            startBtn.addEventListener('click', startAutoGrab);
            stopBtn.addEventListener('click', stopAutoGrab);
            saveConfigBtn.addEventListener('click', saveConfigToLocal);
            loadConfigBtn.addEventListener('click', loadConfigFromLocal);
            refreshOrdersBtn.addEventListener('click', getAvailableOrders);
            clearLogsBtn.addEventListener('click', clearLogs);
            quickStartBtn.addEventListener('click', startAutoGrab);
            quickStopBtn.addEventListener('click', stopAutoGrab);
            
            // 设置默认配置
            delayInput.value = config.delay;
            refreshRateInput.value = config.refreshRate;
            document.getElementById('retryCount').value = config.retryCount;
            document.getElementById('blacklistStrategy').value = config.blacklistStrategy;
            document.getElementById('autoStopToggle').checked = config.autoStop;
            
            // 初始化UI组件
            initProgressBars();
            setupPasswordToggles();
            setupKeywordSelection();
            initDropdowns();
            initTabs();
            initModals();
            initShortcuts();
            
            // 侧边栏切换
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
            
            // 更新黑名单显示
            updateBlacklistDisplay();
            
            // 请求通知权限
            if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                Notification.requestPermission();
            }
            
            // 添加初始日志
            addLog('系统初始化完成，准备就绪', 'info');
            
            // 加载订单数据
            getAvailableOrders();
        }
        
        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
